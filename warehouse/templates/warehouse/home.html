{% extends 'users/base.html' %}
{% load custom_templates %}

{% block content %}
<div class="container-fluid">
    <div class="row">
<!--        side menu-->
        <div class="col-3 bg-dark">
            <ul class="nav flex-column">
                <li class="nav-item mt-3">
                    <a class="nav-link"
                       href="{% url 'warehouse-list-all' %}">
                        <i class="fa fa-eye-slash text-warning"></i> View Stores
                    </a>
                </li>
            </ul>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'warehouse-create' %}">
                        <i class="fa fa-plus text-warning"></i> Add Store
                    </a>
                </li>
            </ul>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'warehouse-bank-create' %}">
                        <i class="fa fa-plus text-warning"></i> Add Bank Account
                    </a>
                </li>
            </ul>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'warehouse-help' %}">
                        <i class="fa fa-question text-warning"></i> Help
                    </a>
                </li>
            </ul>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'home' %}">
                        <i class="fa fa-reply text-warning"></i> Home
                    </a>
                </li>
            </ul>
        </div>
<!--        body of page-->
        <div class="col-9">
            <div class="container mt-2">
                <div class="row">
                    <div class="col">
                        <h3 class="text-center">Stores Home Page</h3>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-sm-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Cummulative Values</h5>
                                <p class="card-text">Total Capacity: {{total_capacity|floatformat:0}}
                                <small class="text-muted">*includes owned properties</small></p>
                                <p class="card-text">Rented Capacity: {{rented_capacity|floatformat:0}}</p>
                                <p class="card-text">Owned Capacity: {{owned_capacity|floatformat:0}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Rent Status</h5>
                                <p class="card-text">Payable: {{N}}{{total_rent_payable_per_annum|floatformat:2}} (#<span>{{stores.count}}</span>)</p>
                                <p class="card-text text-success">Paid: {{N}}{{rent_amount_paid|floatformat:2}} (#<span class="text-success">{{renewal_count}}</span>) </p>
                                <p class="card-text text-danger">Pending: {{N}}{{rent_amount_unpaid|floatformat:2}} 
                                    (#<span class="text-danger">{{stores.count|minus:renewal_count}}</span>) </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Property Use Type</h5>
                                <p class="card-text">
                                    Office: {{N}}{% if rent.office == None %}0.00{% else %}{{rent.office}}{% endif %}
                                    ({{rent_percentage.office|floatformat:2}}%)
                                </p>
                                <p class="card-text">
                                    Apartment: {{N}}{% if rent.apartment == None %}0.00{% else %}{{rent.apartment}}{% endif %}
                                    ({{rent_percentage.apartment|floatformat:2}}%)
                                </p>
                                <p class="card-text">
                                    Sell-out & Storage: {{N}}{% if rent.storage == None %}0.00{% else %}{{rent.storage}}{% endif %}
                                    ({{rent_percentage.storage|floatformat:2}}%)
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <table class="table table-sm" data-toggle="table" data-pagination="true">
                            <caption>Rent Position</caption>
                            <thead>
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Store</th>
                                <th scope="col">Expiry date</th>
                                <th scope="col">Time left</th>
                            </tr>
                            </thead>
                            
                            <tbody>
                            {% for store in stores %}
                                    
                            <tr>     
                                {% now "Y" as current_year %}
                                {% if store.expiry_date|date:"Y" == current_year %}
                                <th scope="row">{{store.id|zeropadding:2}} <i class="fa fa-bolt text-danger"></i></th>
                                {% else %}
                                <th scope="row">{{store.id|zeropadding:2}}</th>
                                {% endif %}
                                <td>{{store.name}}</td>
                                <td>{{store.expiry_date}}</td>
                                   {% if store.expiry_date > today %}
                                <td>{{store.expiry_date|timeuntil}}</td>
                                    {% else %}
                                <td><a href="{% url 'payment' store.pk %}">Rent is due</a></td>
                                    {% endif %}
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <table class="table table-sm" data-toggle="table" data-pagination="true">
                            <caption>Owned</caption>
                            <thead>
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Store</th>
                                <th scope="col">Value</th>
                                <th scope="col">Due Date</th>
                                <th scope="col">Review</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for property in owned_properties %}
                                <tr>
                                <th scope="row">{{property.id}}</th>
                                <td>{{property.name}}</td>
                                <td>{{property.rent_amount}}</td>
                                <td>{{property.expiry_date}}</td>
                                   {% if property.expiry_date <= today %}
                                <td>{{property.expiry_date|timeuntil}}</td>
                                    {% else %}
                                <td class="text-danger">Due for Review</td>
                                    {% endif %}
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content%}