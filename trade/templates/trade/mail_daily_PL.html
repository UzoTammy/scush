{% extends 'mail/base.html' %}
{% load djmoney %}
{% load custom_templates %}

{% block content %}
<div class="container">
    <h5>P & L for {{object.date}} and it's month cummulative
        {% if title == 'Daily Update' %}
        Modified
        {% endif %}
    </h5>
    <hr>
    <p>Sales: {{object.sales}} (<small>total: {{object.total_sales}}</small>)</p>
    <hr>
    <p>Purchase: {{object.purchase}} (<small>total: {{object.total_purchase}}</small>)</p>
    <hr>
    <p>Direct Expenses: {{object.direct_expenses}} (<small>total: {{object.total_direct_expenses}}</small>)</p>
    <hr>
    <p>Indirect Expenses: {{object.indirect_expenses}} (<small>total: {{object.total_indirect_expenses}}</small>)</p>
    <hr>
    <p>Opening Stock: {{object.opening_value}} (<small>as at first day: {{object.opening_stock}}</small>)</p>
    <hr>
    <p>Closing Stock: {{object.closing_value}} (<small>same closing stock</small>)</p> 
    <hr>
    <p>Gross Profit: {{object.gross_profit}} (<small>total: {{object.total_gross_profit}}</small>)</p>
    <hr>
    <p>Direct Income: {{object.direct_income}} (<small>total: {{object.total_direct_income}}</small>)</p> 
    <hr>
    <p>Indirect Income: {{object.indirect_income}} (<small>total: {{object.total_indirect_income}}</small>)</p>
    <hr>
    
    {% if object.net_profit.amount >= 0 %}
    <p>Profit: <span style="color: green;">{{object.net_profit}}</span> 
        (<span style="color:cadetblue">margin ratio: {{object.net_profit|div:object.sales|multiply:100|floatformat:2}}%</span>)</p>
    {% else %}
    <p>Loss: <span style="color: red;">{{object.net_profit|abs}}</span></p>
    {% endif %}
    <small>(
        {% with object.total_gross_profit|minus:object.total_indirect_expenses as profit %}
        {% if profit.amount >= 0 %}
        total profit for the period:
        <span style="color:green">{{profit}}</span>
        {% else %}
        total loss for the period:
        <span style="color:red">{{profit|abs}}</span>
        {% endif %} 
        {% endwith %}
        )  
    </small>
    <hr>
    <p>Check: {{object.opening_value|minus:object.sales|add:object.purchase|add:object.gross_profit|add:object.direct_expenses|minus:object.closing_value}}
        <small style="color: rgb(81, 83, 81);">Opening stock less sales add purchase add gross profit add direct expenses less closing stock</small>
    </p>   
    <hr>
    <h3>Sales Drive Ratio</h3>
    
    <table>
        <tr>
            <th style="text-align: center;">Date</th>
            <th style="text-align: center;">SDR(%)</th>
        </tr>
    
        {% for ratio in object.sales_drive %}
        <tr>
            <td>{{ratio.date|date:'m-d-y'}}</td>
            <td style="text-align: right;">{{ratio.sales.amount|div:ratio.opening_value.amount|multiply:100|floatformat:'2'}}</td>
        </tr> 
    
        {% endfor %}
    </table>
    
    <p>SDR = Sales Vs Opening Stock (last five sales)</p>
    
</div>
{% endblock content %}